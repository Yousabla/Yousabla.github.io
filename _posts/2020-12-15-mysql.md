---
title: 底层数据结构
author: yousabla
date: 2020-12-15 10:16:00 +0800
categories: [八股文,database]
tags: [八股文,database,mysql]
pin: true
---

## MySQL

### 底层数据结构

#### B+树

Mysql数据库使用B+树作为索引，B+树是应文件系统所需而产生的一种B树的变形树（文件目录一级一级索引，只有底层叶结点保存数据），非叶节点只保存索引。

B+树底层使用双向有序链表来存储数据，方便范围查询。

在真实的情况下，3层的B+树可以保存上百万的数据，而上百万的数据查找只需要三次IO，性能提升将是巨大的。

#### 为什么不使用其他类型的数据结构？

- 红黑树/AVL树：等量数据的情况下深度更大，IO频繁，效率低下。
- B树：
  - B树在非叶节点也存储了数据，若data过大，磁盘空间有限，非叶节点能够存放的key就会过少，深度增大，IO频繁。
  - B树底层没有使用链表连接，无法实现数据库中经常涉及到的范围查询。
  - B树优点：非叶节点命中效率高（IO少），相比之下，B+树的命中效率很稳定，几乎没有波动（都是三次IO）。
- 哈希表：
  - 哈希碰撞
  - 范围检索（包括模糊查询）无法实现，有序的索引值在经过hash过后可能会变得无序。
  - 同上，无法通过hash索引来排序。

#### 不同存储引擎实现

事实上，一个加了主键的表的真实结构并不是“表”，而是“树”。

一个没有加主键的表，才是整齐的无序表结构。

在加入主键后，表就变成了树。

在有一亿条数据的情况下，如果没有索引，最坏的情况是我们要匹配一亿次才可能找得到正确的数据。

但在有索引的情况下：

查找次数 = Math.log(数据量，树的枝干数)；

若有一亿数据量，树枝为10（真实情况下树枝只会更多），查找次数会直接降到个位数。

索引除了带来读性能的显著提升之外，也使得写入速度下降。

为了保证树的结构是正确的，在每次增删改操作之后，数据库都需要额外的性能开销来保证树的平衡。

#### MyISAM

MyISAM的特殊点在于其非聚集索引定义不同,其非聚集索引的叶结点直接存储了数据地址,无需二次查询.

- 可以没有主键
- 索引文件与数据文件分离（.myi和.myd）
  - 叶节点的数据文件是数据的相对地址而非数据本身(聚集索引也是)
- 聚集索引(即主键)和非聚集索引结构完全相同只是字段不同.

#### InnoDB

- 主键是聚集索引且必须有主键(若没选则自动选择一个无重复值字段)
  - 没有主键会生成一个长整型的隐含字段,无法访问,长度6字节
- 辅助索引叶结点存储主键,主索引(主键+聚集索引)叶结点存储数据.(二次检索)
- 





























